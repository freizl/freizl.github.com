<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<style type=text/css>body{font-family:monospace}</style>
<title>Chinese Tag In Hakyll</title>
<link rel=stylesheet href=../../css/style.css>
</head>
<body>
<header>
=================<br>
== <a href=https://freizl.github.io/>Corner case</a> ==<br>
=================
<div style=float:right>Welcome to my new blog!</div><br>
<p>
<nav>
<a href=../../><b>Start</b></a>.
</header>
<main>
<article>
<h1>Chinese Tag In Hakyll</h1>
<b><time>04/26/2012</time></b>
<a href=../../tags/hakyll>hakyll</a>
<a href=../../tags/encoding>encoding</a>
<div>
<p><strong>此问题发生在 GHC &lt; 7.2.x 的环境，据说 7.2.x 已经修正了造成此原因的
bug(未验证)。</strong></p>
<h2 id=问题>问题</h2>
<p>Hakyll<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>会给每个标签单独生成一个 html，比如/foo.html/,
用来显示标签对应的所有文章。
然而当标签为中文时，文件名会是乱码，而非对应的中文标签名。</p>
<h2 id=原因>原因</h2>
<p>造成问题是原因由于 Haskell 里写文件的方法。 如下所是，=writeFile=用 base
库里的=String=类型表示文件名， 这就限制其只能表示 ASC-II 字符集。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>  <span style=color:#66d9ef>type</span> <span style=color:#66d9ef>FilePath</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>String</span>

  writeFile <span style=color:#f92672>::</span> <span style=color:#66d9ef>FilePath</span>  <span style=color:#75715e>-- ^ 文件名</span>
            <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>String</span>    <span style=color:#75715e>-- ^ 要写到文件的内容</span>
            <span style=color:#f92672>-&gt;</span> <span style=color:#66d9ef>IO</span> ()
</code></pre></div><h2 id=一种解决办法>一种解决办法</h2>
<p>最直接的方式就是用类库
utf8-string<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>里的=encodeString=方法，现将文件名进行 encode
然后再调=writeFile=方法。比如</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>  <span style=color:#66d9ef>import</span> <span style=color:#66d9ef>qualified</span> Codec.Binary.UTF8.String <span style=color:#66d9ef>as</span> UTF8

  main <span style=color:#f92672>=</span> myWriteFile <span style=color:#e6db74>&#34;新天地.html&#34;</span> <span style=color:#e6db74>&#34;test&#34;</span>
  myWriteFile <span style=color:#f92672>=</span> writeFile <span style=color:#f92672>.</span> <span style=color:#66d9ef>UTF8</span><span style=color:#f92672>.</span>encodeString
</code></pre></div><p>对应到 Hakyll,
就是将上述的改动加到这个文件里/src/Hakyll/Core/Writable.hs/.详见这里<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p>
<h2 id=再一种解决办法>再一种解决办法</h2>
<p>hakyll goole groups 有人帖了他的一个解决方案，也是用 utf8-string 先
encode，但修改的地方不一样。详见此<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>。</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p><a href=http://jaspervdj.be/hakyll/>Hakyll Home</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p><a href=http://hackage.haskell.org/package/utf8-string>Hackage utf8-string</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:3 role=doc-endnote>
<p><a href=https://github.com/freizl/hakyll/commits/private/3.2.6.1>Private branch for hakyll</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:4 role=doc-endnote>
<p><a href=https://github.com/hwa/hakyll/commit/cb7dc75d40fcb2ccbbea9ee3a5582d1ee7fd3cc9>Another fix</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</article>
</main>
<aside>
<div>
<div>
<h3>LATEST POSTS</h3>
</div>
<div>
<ul>
<li><a href=../../posts/hello-hugo/>Hello Hugo</a></li>
<li><a href=../../posts/notes-sf-bay-area-must-do-hiking/>Notes Sf Bay Area Must Do Hiking</a></li>
<li><a href=../../posts/improve-space-usage/>Improve Space Usage</a></li>
<li><a href=../../posts/snaplet-request-local-state/>Snaplet Request Local State</a></li>
<li><a href=../../posts/chinese-tag-in-hakyll/>Chinese Tag In Hakyll</a></li>
</ul>
</div>
</div>
</aside>
<footer>
<p>&copy; 2021 <a href=https://freizl.github.io/><b>Haisheng Wu</b></a>.
</p>
</footer>
</body>
</html>