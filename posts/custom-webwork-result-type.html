<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Custom WebWork Result Type</title>
<meta name="author" content="Haisheng Wu" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://pvinis.github.io/iosevka-webfont/7.0.2/iosevka.css"/>
                           <link rel="stylesheet" type="text/css" href="/css/org-default.css"/>
                           <link rel="stylesheet" type="text/css" href="/css/default.css"/>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="/"> UP </a>
 |
 <a accesskey="H" href="/"> HOME </a>
</div><div id="content" class="content">
<header>
<h1 class="title">Custom WebWork Result Type</h1>
</header><p>
add following to a xwork.xml config file:
</p>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #93E0E3;">result-types</span>&gt; &lt;<span style="color: #93E0E3;">result-type</span> <span style="color: #DFAF8F;">name</span>=<span style="color: #CC9393;">"mydispatch"</span> <span style="color: #DFAF8F;">class</span>=<span style="color: #CC9393;">"com.company.portal.util.MyDispatch"</span> <span style="color: #DFAF8F;">default</span>=<span style="color: #CC9393;">"true"</span>/&gt; &lt;<span style="color: #93E0E3;">result-type</span> <span style="color: #DFAF8F;">name</span>=<span style="color: #CC9393;">"my2dispatch"</span> <span style="color: #DFAF8F;">class</span>=<span style="color: #CC9393;">"MyDispatch"</span> <span style="color: #DFAF8F;">default</span>=<span style="color: #CC9393;">"true"</span>/&gt;<span style="color: #5F7F5F;">&lt;!-- </span><span style="color: #7F9F7F;">spring wire bean</span><span style="color: #5F7F5F;"> --&gt;</span> &lt;/<span style="color: #93E0E3;">result-types</span>&gt;
</pre>
</div>

<p>
use this custom type in the action:
</p>

<div class="org-src-container">
<pre class="src src-xml">&lt;<span style="color: #93E0E3;">action</span> <span style="color: #DFAF8F;">name</span>=<span style="color: #CC9393;">"mydispatch"</span> <span style="color: #DFAF8F;">class</span>=<span style="color: #CC9393;">"myPackage.barAction"</span>&gt; &lt;<span style="color: #93E0E3;">result</span>&gt;foo.jsp&lt;/<span style="color: #93E0E3;">result</span>&gt; &lt;/<span style="color: #93E0E3;">action</span>&gt;

</pre>
</div>


<p>
Actually can simply extend a webwork predefined resulttype for some
purpose and override the conditionalParse and return a final location
for the action. major methods in WebWorkSupport.java
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #9FC59F;">/** * Implementation of the execute method from the Result interface.</span>
<span style="color: #9FC59F;">This will call * the abstract method {[cite/t:@link] #doExecute(String,</span>
<span style="color: #9FC59F;">ActionInvocation)} after optionally evaluating the * location as an OGNL</span>
<span style="color: #9FC59F;">evaluation. * * [cite/t:@param] invocation the execution state of the</span>
<span style="color: #9FC59F;">action. * [cite/t:@throws] Exception if an error occurs while executing</span>
<span style="color: #9FC59F;">the result. */</span>

<span style="color: #F0DFAF; font-weight: bold;">public</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">execute</span>(<span style="color: #7CB8BB;">ActionInvocation</span> <span style="color: #DFAF8F;">invocation</span>) <span style="color: #F0DFAF; font-weight: bold;">throws</span> <span style="color: #7CB8BB;">Exception</span> {
    doExecute(conditionalParse(location, invocation), invocation);
}

<span style="color: #F0DFAF; font-weight: bold;">protected</span> <span style="color: #7CB8BB;">String</span> <span style="color: #93E0E3;">conditionalParse</span>(<span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">param</span>,
<span style="color: #7CB8BB;">ActionInvocation</span> <span style="color: #DFAF8F;">invocation</span>) { <span style="color: #F0DFAF; font-weight: bold;">if</span> (parse &amp;&amp; param != <span style="color: #BFEBBF;">null</span> &amp;&amp; invocation
!= <span style="color: #BFEBBF;">null</span>) { <span style="color: #F0DFAF; font-weight: bold;">return</span> TextParseUtil.translateVariables(param,
invocation.getStack(), <span style="color: #F0DFAF; font-weight: bold;">new</span> <span style="color: #BFEBBF;">TextParseUtil</span>.<span style="color: #7CB8BB;">ParsedValueEvaluator</span>() { <span style="color: #F0DFAF; font-weight: bold;">public</span>
<span style="color: #7CB8BB;">Object</span> <span style="color: #93E0E3;">evaluate</span>(<span style="color: #7CB8BB;">Object</span> <span style="color: #DFAF8F;">parsedValue</span>) { <span style="color: #F0DFAF; font-weight: bold;">if</span> (encode) { <span style="color: #F0DFAF; font-weight: bold;">if</span> (parsedValue !=
<span style="color: #BFEBBF;">null</span>) { <span style="color: #F0DFAF; font-weight: bold;">try</span> { <span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">use UTF-8 as this is the recommended encoding by W3C to</span>
<span style="color: #5F7F5F;">// </span><span style="color: #7F9F7F;">avoid incompatibilities. return</span>
URLEncoder.encode(parsedValue.toString(), <span style="color: #CC9393;">"UTF-8"</span>);
}<span style="color: #F0DFAF; font-weight: bold;">catch</span>(<span style="color: #7CB8BB;">UnsupportedEncodingException</span> <span style="color: #DFAF8F;">e</span>) { _log.warn(<span style="color: #E0CF9F; font-weight: bold;">"</span><span style="color: #CC9393;">error while trying</span>
to encode [<span style="color: #CC9393;">"+parsedValue+"</span>]<span style="color: #E0CF9F; font-weight: bold;">"</span><span style="color: #CC9393;">, e); } } } return parsedValue; } }); } else</span>
{ <span style="color: #F0DFAF; font-weight: bold;">return</span> param; } }

<span style="color: #9FC59F;">/**</span>
<span style="color: #9FC59F;"> * Executes the result given a final location (jsp page, action, etc) and the action invocation</span>
<span style="color: #9FC59F;"> * (the state in which the action was executed).</span>
<span style="color: #9FC59F;"> * Subclasses must implement this class to handle</span>
<span style="color: #9FC59F;"> * custom logic for result handling.</span>
<span style="color: #9FC59F;"> *</span>
<span style="color: #9FC59F;"> * [cite/t:@param] finalLocation the location (jsp page, action, etc) to go to.</span>
<span style="color: #9FC59F;"> * [cite/t:@param] invocation the execution state of the action.</span>
<span style="color: #9FC59F;"> * [cite/t:@throws] Exception if an error occurs while executing the result.</span>
<span style="color: #9FC59F;">*/</span>

<span style="color: #F0DFAF; font-weight: bold;">protected</span> <span style="color: #F0DFAF; font-weight: bold;">abstract</span> <span style="color: #7CB8BB;">void</span> <span style="color: #93E0E3;">doExecute</span>(<span style="color: #7CB8BB;">String</span> <span style="color: #DFAF8F;">finalLocation</span>, <span style="color: #7CB8BB;">ActionInvocation</span> <span style="color: #DFAF8F;">invocation</span>) <span style="color: #F0DFAF; font-weight: bold;">throws</span> <span style="color: #7CB8BB;">Exception</span>;

</pre>
</div>
</div>
<div id="postamble" class="status">
<hr/>
<footer>
  <div class="copyright">Copyright &copy; 2012-present Haisheng Wu</div>
  <div class="generated">Created at 2008-01-27 with <a href="https://www.gnu.org/software/emacs/">Emacs</a> 28.1 (<a href="https://orgmode.org">Org</a> mode 9.6)</div>
</footer>
</div>
</body>
</html>
