<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="IE=edge">
<style type=text/css>body{font-family:monospace}</style>
<title>Euler Problem 104</title>
<link rel=stylesheet href=../../css/style.css>
</head>
<body>
<header>
=================<br>
== <a href=https://freizl.github.io/>Corner case</a> ==<br>
=================
<div style=float:right>Welcome to my new blog!</div><br>
<p>
<nav>
<a href=../../><b>Start</b></a>.
</header>
<main>
<article>
<h1>Euler Problem 104</h1>
<b><time>12/15/2011</time></b>
<a href=../../tags/euler>euler</a>
<a href=../../tags/haskell>haskell</a>
<div>
<h2 id=solutions>Solutions</h2>
<p>There are two solutions below. One is written by me and another from
haskell wiki.</p>
<p>They look quite similar and I can not figure out why the wiki solution
can solve problem but not mine. (Actually mine take more than 15
minutes)</p>
<ul>
<li>My Solution</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>  main <span style=color:#f92672>=</span> print <span style=color:#f92672>$</span> snd <span style=color:#f92672>$</span> head <span style=color:#f92672>$</span>
         dropWhile (<span style=color:#a6e22e>\</span> (x,y) <span style=color:#f92672>-&gt;</span> (not <span style=color:#f92672>.</span> isLastNinePandigit <span style=color:#e6db74>&#34;123456789&#34;</span>) x)
                   (zip fibs [<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>])

  bothNinePandigit digits n <span style=color:#f92672>=</span>  isFirstNinePandigit digits n
                               <span style=color:#f92672>&amp;&amp;</span> isLastNinePandigit digits n

  isLastNinePandigit  digits <span style=color:#f92672>=</span> (<span style=color:#f92672>==</span> digits) <span style=color:#f92672>.</span> sort <span style=color:#f92672>.</span> lastDigits <span style=color:#ae81ff>9</span>
  isFirstNinePandigit digits <span style=color:#f92672>=</span> (<span style=color:#f92672>==</span> digits) <span style=color:#f92672>.</span> sort <span style=color:#f92672>.</span> firstDigits <span style=color:#ae81ff>9</span>

  firstDigits k n <span style=color:#f92672>=</span> take k (show n)
  lastDigits  k n <span style=color:#f92672>=</span> show (n `mod` <span style=color:#ae81ff>10</span><span style=color:#f92672>^</span>k)
</code></pre></div><ul>
<li>Haskell Wiki solution<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>
  fibs <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>:</span> <span style=color:#ae81ff>1</span> <span style=color:#66d9ef>:</span> zipWith (<span style=color:#f92672>+</span>) fibs (tail fibs)

  isFibPan n <span style=color:#f92672>=</span>
    <span style=color:#66d9ef>let</span> a <span style=color:#f92672>=</span> n `mod` <span style=color:#ae81ff>1000000000</span>
        b <span style=color:#f92672>=</span> sort (show a)
        c <span style=color:#f92672>=</span> sort <span style=color:#f92672>$</span> take <span style=color:#ae81ff>9</span> <span style=color:#f92672>$</span> show n
    <span style=color:#66d9ef>in</span>  b <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;123456789&#34;</span> <span style=color:#f92672>&amp;&amp;</span> c <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;123456789&#34;</span>

  ex_104 <span style=color:#f92672>=</span> snd <span style=color:#f92672>$</span> head <span style=color:#f92672>$</span>
           dropWhile (<span style=color:#a6e22e>\</span>(x,y) <span style=color:#f92672>-&gt;</span> (not <span style=color:#f92672>.</span> isFibPan) x) (zip fibs [<span style=color:#ae81ff>1</span><span style=color:#f92672>..</span>])
</code></pre></div><h2 id=why-the-differences>Why the differences?</h2>
<p>The key point here is should test start nine digits first or test end
nine digits.</p>
<p>Two concerns here:</p>
<ol>
<li><code>show</code> function is (relatively) slow which used in test first 9
digits function.</li>
<li>quite few numbers are end in digits 1..9 in the first 329000 numbers</li>
</ol>
<p>Therefore test last 9 digits first make great performance improvement.</p>
<p><em>Thanks Brent<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup> explanation this sneaky thing very comprehensively
in haskell-beginner.</em></p>
<h2 id=profiling>Profiling</h2>
<p>What help to identify is the GHC profiling tool.</p>
<p>Several options used here are</p>
<ul>
<li>
<p><strong>prof</strong>: for basic time and allocation profiling</p>
</li>
<li>
<p><strong>auto-all</strong>: auto insert cost centers on all top level functions. &ldquo;cost
center&rdquo; is a location in the program like to collect statistics about
and GHC will generate code to compute the cost of evalutating the
expression at each location. e.g.</p>
</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>    mean  s <span style=color:#f92672>=</span> <span style=color:#75715e>{-# SCC &#34;mean&#34; #-}</span> sum  s <span style=color:#f92672>/</span> fromIntegral (length s)
</code></pre></div><ul>
<li>
<p><strong>caf-all</strong>: function with no parameters only computed once. CAF means
constant applicative forms which used for calculate that once time
evaluation.</p>
</li>
<li>
<p><strong>fforce-recomp</strong>: force full recompilation.</p>
</li>
</ul>
<p>More details could go to chapter 25<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup> of [Real World Haskell] and
GHC user guider chapter 5<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-haskell data-lang=haskell>  <span style=color:#f92672>#</span> build with prof option on
  ghc <span style=color:#75715e>--make -O2 -prof -auto-all -rtsopts p104.hs</span>

  <span style=color:#f92672>#</span> <span style=color:#66d9ef>then</span> run
  <span style=color:#f92672>./</span>p104 <span style=color:#f92672>+</span><span style=color:#66d9ef>RTS</span> <span style=color:#f92672>-</span>p <span style=color:#f92672>-</span><span style=color:#66d9ef>RTS</span>
</code></pre></div><h2 id=further>Further</h2>
<ol>
<li>Chapter 25 in Real Work Haskell about profile</li>
</ol>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p><a href=http://www.haskell.org/haskellwiki/Euler%5Fproblems/100%5Fto%5F110>Haskell Wiki Euler Problem</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:2 role=doc-endnote>
<p><a href=http://comments.gmane.org/gmane.comp.lang.haskell.beginners/9175>Haskell Beginner 9175</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:3 role=doc-endnote>
<p><a href=http://book.realworldhaskell.org/read/profiling-and-optimization.html>Profiling and optimization</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
<li id=fn:4 role=doc-endnote>
<p><a href=http://www.haskell.org/ghc/docs/latest/html/users%5Fguide/profiling.html>GHC User Guider</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</article>
</main>
<aside>
<div>
<div>
<h3>LATEST POSTS</h3>
</div>
<div>
<ul>
<li><a href=../../posts/hello-hugo/>Hello Hugo</a></li>
<li><a href=../../posts/notes-sf-bay-area-must-do-hiking/>Notes Sf Bay Area Must Do Hiking</a></li>
<li><a href=../../posts/improve-space-usage/>Improve Space Usage</a></li>
<li><a href=../../posts/snaplet-request-local-state/>Snaplet Request Local State</a></li>
<li><a href=../../posts/chinese-tag-in-hakyll/>Chinese Tag In Hakyll</a></li>
</ul>
</div>
</div>
</aside>
<footer>
<p>&copy; 2021 <a href=https://freizl.github.io/><b>Haisheng Wu</b></a>.
</p>
</footer>
</body>
</html>